<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Coast To Retirement Calculator</title>

<!-- CSS / Script Libraries -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3" crossorigin="anonymous"></script>
<script src='https://unpkg.com/vue@next'></script>

</head>
<body class="container mt-4">

<!-- Application HTML Vue Template -->

<div id="app">
  <div class="container mt-4 mb-4">
    <h1 class="">{{appTitle}}</h1>
    <hr>
    <calc-num v-model.number="params.currentIncome" type="dollar">Net Income</calc-num>
    <calc-num v-model.number="params.currentSavings" type="dollar">Annual Savings</calc-num>
    <calc-num v-model.number="params.currentWorth" type="dollar">Starting Net Worth</calc-num>
    <calc-num v-model.number="params.currentAge" type="int">Current Age</calc-num>
    <hr>
    <calc-num v-model.number="params.coastAge" type="int" readonly>Coast Age</calc-num>
    <calc-num v-model.number="params.retireAge" type="int">Retirement Age</calc-num>
    <calc-num v-model.number="params.costOfLiving" type="dollar" readonly>Cost of Living</calc-num>
    <calc-num v-model.number="params.retireWorth" type="dollar" readonly>Retirement Needed</calc-num>
    <hr>
    <calc-num v-model.number="params.returnOnInvestment" type="percent">Average Returns</calc-num>
    <calc-num v-model.number="params.rateOfInflation" type="percent">Annual Inflation</calc-num>
    <hr>
  </div>

  <div id="results">
  <ul class="nav nav-tabs nav-fill" id="myTab" role="tablist">
    <li class="nav-item" role="presentation">
      <button class="nav-link active" id="chart-tab" data-bs-toggle="tab" data-bs-target="#chart-tab-pane" type="button" role="tab" aria-controls="chart-tab-pane" aria-selected="true">Chart</button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="graph-tab" data-bs-toggle="tab" data-bs-target="#graph-tab-pane" type="button" role="tab" aria-controls="graph-tab-pane" aria-selected="false">Graph</button>
    </li>
  </ul>
  <div class="tab-content " id="myTabContent">
    <div class="tab-pane fade show active" id="chart-tab-pane" role="tabpanel" aria-labelledby="table-tab" tabindex="0">
      <table class="table table-striped table-sm text-end mt-4">
        <thead>
          <tr>
            <th scope="col">Age</th>
            <th scope="col">Savings</th>
            <th scope="col">Earned Interest</th>
            <th scope="col">Contribution</th>
          </tr>
        </thead>
        <tbody>
          <tr v-for="yr in calculations">
            <th scope="row">{{yr.age}}</th>
            <td>{{printDollar(yr.savings)}}</td>
            <td>{{printDollar(yr.interest)}}</td>
            <td>{{printDollar(yr.contribution)}}</td>
            <td></td>
          </tr>
          </tbody>
        </table>
    </div>
    <div class="tab-pane fade" id="graph-tab-pane" role="tabpanel" aria-labelledby="graph-tab" tabindex="0">
      
      <p class="mt-3 ml-4">TODO</p>
    </div>
  </div>
</div>
    
</div>

<!-- Application Code -->
<script>

const App = Vue.createApp({
  data() {
    return {
      appTitle: 'Coasting to Retirement',
      params: {
        currentIncome: 71000,
        currentSavings: 16000,
        currentWorth: 150000,
        currentAge: 25,
        retireAge: 55,

        costOfLiving: 0,
        retireWorth: 0,
        coastAge: 0,

        returnOnInvestment: 9.0,
        rateOfInflation: 4.0,
      },

      dollarFmt: null,
      printDollar: null,
      calculations: []
    }
  },
  watch: {
    params: {
      handler(newParams, oldParams) {
      this.updateCalculations();
      },
      deep: true
    }
  },
 
  created() {

    this.dollarFmt =
        new Intl.NumberFormat('en-US', {
        style: 'currency',
        currency: 'USD',
        maximumFractionDigits: 0
        });

    this.printDollar = this.dollarFmt.format

    this.updateCalculations()
  },

  methods: {

    updateCalculations() {

      const params = this.params
      let interestRate = (params.returnOnInvestment - params.rateOfInflation) / 100
      params.costOfLiving = Math.floor(params.currentIncome - params.currentSavings)
      params.retireWorth = Math.floor(params.costOfLiving / interestRate)

      let savings = params.currentWorth
    
      let newResults = []

      for(let age = params.currentAge; age < 100; age++) {
        
        const interest = savings * interestRate

        let contribution = 0
        if (age < params.retireAge) 
          contribution = params.currentSavings;
        else
          contribution = -(params.costOfLiving);
        

        newResults.push(
          { age, 
            savings, 
            interest,
            contribution});

        savings += interest + contribution
      }
      
      this.calculations = newResults    
    }
    },
})

const calcNum = {
  props : ['modelValue', 'type', 'readonly'],
  template: 
  '<div class="row mt-2"> \
    <label class="col col-form-label text-end"> \
      <slot></slot> \
    </label> \
    <div class="col input-group input-group-sm"> \
      <span v-if="isDollar" class="input-group-text">$</span>\
      <input :value="modelValue" @change="updateModelValue" class="form-control text-end" v-bind="isDisabled" placeholder="" type="text"> \
      <span v-if="isPercent" class="input-group-text">%</span>\
      <span v-if="isInt" class="input-group-text">yr</span>\
    </div> \
  </div>',

  computed: {
    isDisabled() {
      return { disabled: this.readonly }
    },
    isPercent() {
      return this.type == "percent"
    },
    isDollar() {
      return this.type == "dollar"
    },
    isInt() {
      return this.type == "int"
    },
  },

  methods: {
  updateModelValue(e) {
    //if (validate a number) {
      this.$emit('update:modelValue', e.target.value)
    //}
  }},
}

App.component('calc-num', calcNum)
App.mount('#app')

</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3" crossorigin="anonymous"></script>
</body>
</html>


